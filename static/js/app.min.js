function initializeApp(){initializeRatingSystem(),initializeComments(),initializeFormImagePreviews(),initializeToasts(),initializeModals(),initializeDynamicForms(),initializeTagSelection(),initializeRecipeControls(),initializeLikeButtons(),initializeIngredientCheckboxes()}function initializeRatingSystem(){const e=document.querySelector(".user-rating-overlay");if(!e)return;const t=e.querySelectorAll(".star-interactive"),n=document.getElementById("rating-value"),i=document.getElementById("rating-form"),o=parseInt(e.dataset.currentRating)||0;function c(e,n=!1){t.forEach((t,i)=>{t.classList.remove("selected","hover"),i<e&&t.classList.add(n?"hover":"selected")})}c(o),t.forEach((e,t)=>{const r=t+1;e.addEventListener("mouseenter",function(){c(r,!0)}),e.addEventListener("mouseleave",function(){c(parseInt(n.value)||o)}),e.addEventListener("click",function(e){e.preventDefault(),n.value=r,c(r);const t=this.title;this.title="Rating submitted!",setTimeout(()=>{this.title=t},2e3),i.submit()})})}function initializeComments(){const e=document.querySelectorAll(".reply-btn"),t=document.querySelectorAll(".cancel-reply");e.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.commentId,t=document.getElementById(`reply-form-${e}`);document.querySelectorAll(".reply-form").forEach(e=>{e.style.display="none"}),t.style.display="block",t.querySelector("textarea").focus()})}),t.forEach(e=>{e.addEventListener("click",function(){this.closest(".reply-form").style.display="none"})})}function initializeFormImagePreviews(){const e=document.querySelector('input[type="file"][name="profile_image"]');e&&e.addEventListener("change",function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){const t=document.querySelector('img[alt="Current profile picture"]');t&&(t.src=e.target.result)},e.readAsDataURL(t)}});const t=document.querySelector('input[type="file"][name="image"]');t&&t.addEventListener("change",function(e){const n=e.target.files[0];if(n){const e=new FileReader;e.onload=function(e){let n=document.querySelector(".image-preview");n||(n=document.createElement("img"),n.className="image-preview img-fluid rounded mt-2",n.style.maxHeight="200px",t.parentNode.appendChild(n)),n.src=e.target.result},e.readAsDataURL(n)}})}function initializeToasts(){document.querySelectorAll(".toast:not(#authToast):not(#recipeSuccessToast)").forEach(e=>{const t=e.querySelector(".toast-body");if(t&&t.textContent.trim()){new bootstrap.Toast(e,{autohide:!0,delay:7e3}).show()}});document.querySelectorAll(".toast.bg-custom-success .toast-body").forEach(e=>{if(e.textContent.trim()){showRecipeSuccessToast(e.textContent.trim());const t=e.closest(".toast");t&&(t.style.display="none")}})}function showRecipeSuccessToast(e){const t=document.getElementById("recipeSuccessToast"),n=document.getElementById("recipeSuccessToastMessage");if(t&&n){n.textContent=e;new bootstrap.Toast(t,{autohide:!0,delay:7e3}).show()}}function initializeModals(){const e=document.getElementById("loginModal"),t=document.getElementById("registerModal");if(e&&t){const n=document.querySelector('[data-bs-target="#registerModal"]');n&&n.addEventListener("click",function(){const t=bootstrap.Modal.getInstance(e);t&&t.hide()});const i=document.querySelector('[data-bs-target="#loginModal"]');i&&i.addEventListener("click",function(){const e=bootstrap.Modal.getInstance(t);e&&e.hide()})}}function showFieldError(e,t){const n=document.querySelector(`[name="${e}"]`);if(n){n.classList.add("is-invalid");let e=n.parentNode.querySelector(".invalid-feedback");e||(e=document.createElement("div"),e.className="invalid-feedback",n.parentNode.appendChild(e)),e.textContent=t}}function clearFieldErrors(){document.querySelectorAll(".is-invalid").forEach(e=>{e.classList.remove("is-invalid")}),document.querySelectorAll(".invalid-feedback").forEach(e=>{e.remove()})}function initializeDynamicForms(){document.addEventListener("click",function(e){e.target.matches(".btn-remove-row, .remove-row")&&removeRow(e.target)})}function removeRow(e){const t=e.closest(".ingredient-row, .step-row, .dynamic-form-row");t&&t.remove()}function addIngredientRow(){const e=document.querySelector("#ingredient-formset");if(!e)return;const t=e.querySelector(".ingredient-row:last-child");if(t){const n=t.cloneNode(!0);n.querySelectorAll("input, select, textarea").forEach(e=>{"checkbox"===e.type||"radio"===e.type?e.checked=!1:e.value=""}),updateFormIndices(n,e.children.length-1),e.appendChild(n);const i=n.querySelector(".ingredient-autocomplete");i&&window.ingredientsData&&setupAutocomplete(i,window.ingredientsData)}}function addStepRow(){const e=document.querySelector("#step-formset");if(!e)return;const t=e.querySelector(".step-row:last-child");if(t){const n=t.cloneNode(!0);n.querySelectorAll("input, select, textarea").forEach(e=>{"checkbox"===e.type||"radio"===e.type?e.checked=!1:e.value=""}),updateFormIndices(n,e.children.length-1),e.appendChild(n)}}function updateFormIndices(e,t){e.querySelectorAll("input, select, textarea").forEach(e=>{e.name&&(e.name=e.name.replace(/\d+/,t)),e.id&&(e.id=e.id.replace(/\d+/,t))}),e.querySelectorAll("label").forEach(e=>{e.htmlFor&&(e.htmlFor=e.htmlFor.replace(/\d+/,t))})}function showLoading(e){e.classList.add("loading"),e.disabled=!0}function hideLoading(e){e.classList.remove("loading"),e.disabled=!1}function debounce(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...i)},t)}}function initializeTagSelection(){document.querySelectorAll(".tag-selection").forEach(e=>{e.querySelectorAll(".tag-selectable").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById(this.getAttribute("for"));t&&(t.checked=!t.checked,this.classList.toggle("tag-selected",t.checked),t.dispatchEvent(new Event("change",{bubbles:!0})))})});e.querySelectorAll(".tag-checkbox").forEach(t=>{const n=e.querySelector(`label[for="${t.id}"]`);n&&t.checked&&n.classList.add("tag-selected")})})}function initializeRecipeControls(){const e=document.querySelectorAll("#servings-scaler, #servings-scaler-mobile"),t=document.querySelectorAll("#decrease-servings, #decrease-servings-mobile"),n=document.querySelectorAll("#increase-servings, #increase-servings-mobile"),i=document.querySelectorAll("#unit-system-toggle, #unit-system-toggle-mobile"),o=document.querySelectorAll("#unit-system-label, #unit-system-label-mobile"),c=parseInt(e[0]?.dataset.original)||1;let r=!1;function a(){const t=(parseInt(e[0]?.value)||c)/c;document.querySelectorAll(".ingredient-amount").forEach(e=>{const n=parseFloat(e.dataset.originalQuantity),i=e.dataset.unit,o=e.dataset.unitName;if(["to taste","taste","pinch","dash","handful","splash","drizzle","sprinkle","garnish"].some(e=>o.toLowerCase().includes(e.toLowerCase())))e.textContent=o;else if(r){const i=function(e,t,n){const i=t.toLowerCase(),o=["to taste","taste","pinch","dash","handful","splash","drizzle","sprinkle","garnish"],c=o.some(e=>i.includes(e.toLowerCase()));if(c)return t;const r=e*n;if(i.includes("ml")||i.includes("milliliter")){if(r>=1e3){const e=r/240;return`${e.toFixed(1)} Cup${e>1?"s":""}`}return r>=250?`${(r/240).toFixed(1)} Cups`:r>=15?`${(r/15).toFixed(1)} Tbsp`:`${(r/5).toFixed(1)} Tsp`}if(i.includes("gram")||"g"===i){if(r>=450)return`${(r/453.6).toFixed(1)} Lb${r>900?"s":""}`;if(r>=28)return`${(r/28.35).toFixed(1)} Oz`}if(i.includes("kilogram")||"kg"===i)return`${(2.2*r).toFixed(1)} Lbs`;if(i.includes("liter")||"l"===i)return`${(4.2*r).toFixed(1)} Cups`;return`${r%1==0?r.toString():r.toFixed(1).replace(/\.?0+$/,"")} ${t}`}(n,o,t);e.textContent=i}else{const o=n*t,c=o%1==0?o.toString():o.toFixed(1).replace(/\.?0+$/,"");e.textContent=`${c} ${i}`}})}e.forEach(e=>{e.addEventListener("change",a),e.addEventListener("input",a)}),t.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>{const t=parseInt(e.value);t>1&&(e.value=t-1,a())})})}),n.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>{const t=parseInt(e.value);t<20&&(e.value=t+1,a())})})}),i.forEach(e=>{e.addEventListener("change",e=>{r=e.target.checked,i.forEach(e=>{e.checked=r}),o.forEach(e=>{e.textContent=r?"US":"Metric"}),a()})})}function initializeLikeButtons(){document.querySelectorAll(".like-form").forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault();const t=this.querySelector(".like-btn"),n=(t.querySelector("i"),t.querySelector(".like-count")),i=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin"></i>',t.disabled=!0,fetch(this.action,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":this.querySelector("[name=csrfmiddlewaretoken]").value}}).then(e=>e.json()).then(e=>{e.liked?(t.classList.remove("btn-outline-light"),t.classList.add("btn-danger")):(t.classList.remove("btn-danger"),t.classList.add("btn-outline-light")),n&&(n.textContent=e.like_count),t.innerHTML=i,t.disabled=!1,t.style.transform="scale(1.1)",setTimeout(()=>{t.style.transform=""},150)}).catch(e=>{console.error("Error:",e),t.innerHTML=i,t.disabled=!1})})})}function initializeIngredientCheckboxes(){const e=document.querySelectorAll(".ingredient-checkbox");e.forEach(e=>{"true"===localStorage.getItem(`ingredient-${e.id}`)&&(e.checked=!0),e.addEventListener("change",function(){localStorage.setItem(`ingredient-${this.id}`,this.checked);const e=this.parentElement.querySelector("label");this.checked&&(e.style.transition="all 0.3s ease")})});const t=document.querySelector("#clear-all-ingredients");t&&t.addEventListener("click",function(){e.forEach(e=>{e.checked=!1,localStorage.removeItem(`ingredient-${e.id}`)})})}document.addEventListener("DOMContentLoaded",function(){initializeApp()}),window.OnlyPansApp={showFieldError:showFieldError,clearFieldErrors:clearFieldErrors,showLoading:showLoading,hideLoading:hideLoading,debounce:debounce,removeRow:removeRow,addIngredientRow:addIngredientRow,addStepRow:addStepRow,showRecipeSuccessToast:showRecipeSuccessToast},document.addEventListener("DOMContentLoaded",function(){initializeLikeButtons()});